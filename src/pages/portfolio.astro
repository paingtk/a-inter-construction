---
import Layout from '../layouts/Layout.astro';
import { Image } from 'astro:assets';
import { getLangFromUrl, useTranslations } from '../i18n/translations';
import { projects as allProjects, categories as allCategories } from '../i18n/projects';
import fiberOpticFactory from '../assets/image.png';
import waterBottlingPlant from '../assets/water-bottling-plant.png';
import machineShop from '../assets/machine-shop.png';
import fmtWarehouse from '../assets/fmt-warehouse.png';
import htdWarehouse from '../assets/htd-warehouse.png';
import qHouseRama5Residence from '../assets/q-house-rama-5-residence.png';
import nakhonPathomResidence from '../assets/nakhon-pathom-residence.png';
import phetchaburiResidence from '../assets/phetchaburi-residence.png';
import twoStoryResidence from '../assets/two-story-residence.png';
import grandBangkokBoulevardResidence from '../assets/grand-bangkok-boulevard-residence.png';
import rcTwoStoryResidence from '../assets/rc-two-story-residence.png';
import fourStoryBuildingAndWarehouses from '../assets/four-story-building-and-warehouses.png';

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

const projects = allProjects[lang];
const categories = allCategories[lang];

const projectImages = [fiberOpticFactory, waterBottlingPlant, machineShop, fmtWarehouse, htdWarehouse, qHouseRama5Residence, nakhonPathomResidence, phetchaburiResidence, twoStoryResidence, grandBangkokBoulevardResidence, rcTwoStoryResidence, fourStoryBuildingAndWarehouses];

const projectsWithImages = projects.map((project, index) => ({
  ...project,
  image: projectImages[index] || null,
}));
---

<Layout title={t('portfolio.title')}>
  <section class="page-header">
    <div class="container">
      <h1>{t('portfolio.heading')}</h1>
      <p>{t('portfolio.subtitle')}</p>
    </div>
  </section>

  <section class="portfolio section">
    <div class="container">
      <div class="filter-buttons">
        {categories.map((category, index) => (
          <button class:list={["filter-btn", { active: index === 0 }]} data-category={index === 0 ? "all" : category}>{category}</button>
        ))}
      </div>

      <div class="projects-grid">
        {projectsWithImages.map((project) => (
          <article class="project-card" data-category={project.category}>
            <div class="project-image">
              {project.image && <Image src={project.image} alt={project.title} class="project-img" />}
              <span class="project-category">{project.category}</span>
            </div>
            <div class="project-content">
              <h3>{project.title}</h3>
              <span class="project-title-en">{project.titleEn}</span>
              <div class="project-details">
                <div class="detail-item">
                  <span class="detail-label">{t('portfolio.client')}</span>
                  <span class="detail-value">{project.client}</span>
                </div>
                <div class="detail-item">
                  <span class="detail-label">{t('portfolio.location')}</span>
                  <span class="detail-value">{project.location}</span>
                </div>
                <div class="detail-row">
                  <div class="detail-item">
                    <span class="detail-label">{t('portfolio.value')}</span>
                    <span class="detail-value highlight">{project.value}</span>
                  </div>
                  <div class="detail-item">
                    <span class="detail-label">{t('portfolio.area')}</span>
                    <span class="detail-value">{project.area}</span>
                  </div>
                </div>
              </div>
            </div>
          </article>
        ))}
      </div>
    </div>
  </section>
</Layout>

<style>
  .page-header {
    background-color: var(--color-primary);
    color: var(--color-white);
    padding: 4rem 0;
  }

  .page-header h1 {
    font-size: 2.5rem;
    font-weight: 600;
    margin-bottom: 0.75rem;
  }

  .page-header p {
    font-size: 1.125rem;
    opacity: 0.9;
    max-width: 500px;
  }

  .filter-buttons {
    display: flex;
    gap: 0.75rem;
    margin-bottom: 2.5rem;
    flex-wrap: wrap;
  }

  .filter-btn {
    padding: 0.625rem 1.25rem;
    background-color: var(--color-white);
    border: 1px solid var(--color-border);
    color: var(--color-text-light);
    cursor: pointer;
    font-size: 0.875rem;
    transition: all 0.2s ease;
  }

  .filter-btn:hover,
  .filter-btn.active {
    background-color: var(--color-primary);
    border-color: var(--color-primary);
    color: var(--color-white);
  }

  .projects-grid {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
  }

  .project-card {
    display: grid;
    grid-template-columns: 350px 1fr;
    background-color: var(--color-white);
    border: 1px solid var(--color-border);
    overflow: hidden;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }

  .project-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
  }

  .project-card.hidden {
    display: none;
  }

  .project-image {
    height: 100%;
    min-height: 220px;
    background-color: var(--color-bg-alt);
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
  }

  .project-image :global(.project-img) {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .project-category {
    position: absolute;
    top: 1rem;
    left: 1rem;
    background-color: var(--color-primary);
    color: var(--color-white);
    padding: 0.375rem 0.75rem;
    font-size: 0.75rem;
    font-weight: 500;
  }

  .project-content {
    padding: 1.75rem 2rem;
    display: flex;
    flex-direction: column;
    justify-content: center;
  }

  .project-content h3 {
    font-size: 1.25rem;
    font-weight: 600;
    margin-bottom: 0.25rem;
    color: var(--color-text);
  }

  .project-title-en {
    display: block;
    font-size: 0.875rem;
    color: var(--color-primary);
    margin-bottom: 1.25rem;
  }

  .project-details {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
  }

  .detail-item {
    display: flex;
    flex-direction: column;
    gap: 0.125rem;
  }

  .detail-row {
    display: contents;
  }

  .detail-label {
    font-size: 0.6875rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--color-text-light);
  }

  .detail-value {
    font-size: 0.9375rem;
    color: var(--color-text);
  }

  .detail-value.highlight {
    color: var(--color-primary);
    font-weight: 600;
  }

  @media (max-width: 900px) {
    .project-card {
      grid-template-columns: 280px 1fr;
    }
  }

  @media (max-width: 768px) {
    .page-header h1 {
      font-size: 2rem;
    }

    .project-card {
      grid-template-columns: 1fr;
    }

    .project-image {
      min-height: 200px;
    }

    .project-details {
      grid-template-columns: 1fr;
    }
  }
</style>

<script>
  const filterButtons = document.querySelectorAll('.filter-btn');
  const projectCards = document.querySelectorAll('.project-card');

  filterButtons.forEach(button => {
    button.addEventListener('click', () => {
      filterButtons.forEach(btn => btn.classList.remove('active'));
      button.classList.add('active');

      const category = button.dataset.category;

      projectCards.forEach(card => {
        if (category === 'all' || card.dataset.category === category) {
          card.classList.remove('hidden');
        } else {
          card.classList.add('hidden');
        }
      });
    });
  });
</script>
